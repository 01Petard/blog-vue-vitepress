# 鹰瞳Airdoc第三方对接文档总结

> 不卖的产品：如果F16AN、F16AF，售完即止：K203，主力：F16H

## 一、对接文档核心内容

### 1. [标准 API 对接 - 仅接口](https://doc.airdoc.com/third-party-docs/post/standard-api/)

- **适用场景**：有开发能力的**医院、体检中心**。
- **适用设备**：自研相机（Fd16R、Fd16AF）+ 外采相机（新视野、佳能、拓普康等）。
- **核心流程**：
  1. 用户在第三方系统登记，推送基础信息至鹰瞳 Airdoc 系统；
  2. 第三方生成条码 / 二维码，工作人员用**相机管理软件扫码启动相机**拍摄眼底影像；
  3. 相机管理软件将影像上传至鹰瞳，鹰瞳系统匹配信息生成报告；
  4. 鹰瞳通过接口推送报告，或第三方通过接口查询报告，最终展示给用户。
- **核心接口**：
  - 接口 1：接收用户信息（一次最多传 50 条，需签名验证，含 appid、user_id 等参数）；
  - 接口 2：鹰瞳推送报告（含 H5 链接 <长期有效>、PDF 链接 < 3 天有效 >、左右眼结果等）；
  - 接口 3：第三方查询报告状态（支持按 uuid/medical_record_no 查询）；
- **辅助信息**：明确病史编码（0 = 无，1 = 糖尿病等）、错误码（如 900034 = 设备序列号未找到）、常见问题（如接口 1 报错需检查 data 为数组）。

### 2. [标准 API 对接 - H5 启动页面](https://doc.airdoc.com/third-party-docs/post/standard-api-clouds/)

- **适用场景**：有开发能力的**大健康、代理商、健康小屋**（侧重用户自助启动）。
- **适用设备**：仅自研相机（Fd16r、Fd16g、FD16aN、FD16aF）。
- **核心流程**：
  1. 用户在第三方系统登记，推送基础信息至鹰瞳；
  2. 鹰瞳返回**H5 相机启动页面、链接失效时间、筛查码（pcode）**；
  3. 第三方跳转至 H5 页面，用户点击启动相机拍摄，影像自动上传；
  4. 鹰瞳匹配生成报告，推送或第三方查询，最终展示。
- **核心接口**：
  - 接口 1：接收用户信息（一次仅 1 条，返回 H5 链接等，参数多了 “sn < 设备序列号>”“h5_start”）；
  - 接口 2：鹰瞳推送报告（含 H5 链接 <长期有效>、PDF 链接 < 3 天有效 >、左右眼结果等）；
  - 接口 3：查询报告状态（支持 medical_record_no/pcode 查询，pcode 优先用于多次检查场景）；
- **辅助信息**：错误码比 document1 更丰富（如 600009 = 余额不足、600081 = 没有权限）。

### 3. [标准中间库对接 - 扁鹊前置机](https://doc.airdoc.com/third-party-docs/post/middle-database/)

- **核心模式**：通过**数据库视图 + FTP/HTTP**实现数据交互（无需 API 接口开发，侧重数据层对接）。
- **适用场景**：需通过数据库传递用户信息、报告数据的机构（未明确设备，默认支持相机扫码拍摄）。
- **核心流程**：
  1. 用户在第三方登记，合作伙伴不推送用户数据，仅提供**数据库视图（AIRDOC_BASE_INFO）**；
  2. 鹰瞳在前置机部署扁鹊，扁鹊系统读取数据库视图，将用户信息推送至鹰瞳；（扁鹊替代机构完成了之前推送用户信息的功能）
  3. 工作人员用相机软件扫流水号（pcode）拍摄，扁鹊系统将影像上传至鹰瞳生成报告；
  4. 鹰瞳通过三种方式传报告：
     - 将数据写入合作伙伴**结果表（AIRDOC_CHECK_RESULT，含 PDF 路径、左右眼结果）**；
     - HTTP 下载（前置机中间服务：http://<内网 IP>:8801/.../pdf）；
     - FTP 上传（鹰瞳传至合作伙伴 FTP 服务器，按年月日建文件夹）。
- **辅助信息**：用户信息视图需必填 pcode、生日、身份证号 / 医保卡号 / 医院内部标识（三选一），病史编码与前两篇一致。

### 4. [第三方公众号对接](https://doc.airdoc.com/third-party-docs/post/weixin-third/)

- **核心模式**：基于**微信服务号 + 小程序**的生态对接（侧重社交场景触达用户）。
- **适用场景**：需通过微信公众号推送通知、引导用户登记 / 查询报告的机构。
- **前置条件**：微信公众号为服务号；已开发的公众号需屏蔽 `WECHAT_OPEN_PLATEFROM` 前缀消息。
- **核心流程**：
  1. 配置公众号：授权鹰瞳接入→设置服务类目（工具 > 预约 / 报名、工具 > 健康管理）→添加模板消息（2 个 “预约成功通知”、1 个 “体检报告生成通知”）→关联小程序（ID：wxe15965084f03c697）；
  2. 鹰瞳生成**设备定制 SN 二维码**，SN码贴在用户会扫描的设备上；
  3. 用户扫码进公众号→点击模板消息进小程序登记信息→启动设备拍摄；
  4. 报告生成后，公众号推送模板消息，用户点击查看报告。
- **辅助信息**：模板消息需按固定关键词配置（如 “预约成功通知” 需含 “客户名称、预约项目、预约时间”）。

## 二、相同点

1. **核心目标一致**：均实现 “第三方系统与鹰瞳 Airdoc 的对接”，完成 “用户信息登记→眼底影像拍摄上传→报告生成→报告接收 / 展示” 的全流程闭环。
2. **用户信息核心字段一致**：均需传递姓名、性别、年龄、病史（编码统一：0 = 无，1 = 糖尿病，2 = 高血压等），且用户唯一标识（如 medical_record_no、pcode）为必填。
3. **报告核心内容一致**：均包含左右眼检查结果、综合建议，PDF 报告格式统一（有效期多为 3 天），H5 报告长期有效。
4. **安全验证逻辑一致**：API 对接场景（document1、2）均需签名验证（md5/sha1，含 appid、timestamp、secret_key）；数据库对接（document3）需前置机权限控制；公众号对接（document4）需管理员扫码授权。

## 三、不同点

| 对比维度             | document1（标准 API）                    | document2（API-H5 启动）                 | document3（中间库对接）            | document4（公众号对接）              |
| -------------------- | ---------------------------------------- | ---------------------------------------- | ---------------------------------- | ------------------------------------ |
| **适用场景**         | 院内、体检中心（专业医疗场景）           | 大健康、代理商、健康小屋（自助场景）     | 需数据库传数据的机构（数据层对接） | 微信生态用户（社交触达场景）         |
| **设备支持**         | 自研 + 外采（佳能、拓普康等）            | 仅自研特定型号（Fd16r/g 等）             | 未明确，默认支持相机扫码           | 未提设备，侧重微信端操作             |
| **启动拍摄方式**     | 第三方生成条码 / 二维码，相机软件扫码    | 跳转 H5 页面，用户点击启动               | 相机软件扫流水号（pcode）          | 用户扫公众号 SN 二维码，进小程序启动 |
| **数据交互方式**     | API 接口（POST+JSON）                    | API 接口（POST+JSON，返回 H5 链接）      | 数据库视图 + 结果表 / FTP/HTTP     | 公众号授权 + 模板消息 + 小程序关联   |
| **用户信息传递限制** | 接口 1 一次最多 50 条                    | 接口 1 一次仅 1 条                       | 按数据库视图批量读取               | 小程序单用户单次登记                 |
| **报告接收方式**     | 鹰瞳推送（接口 2）/ 第三方查询（接口 3） | 同 document1，接口 3 支持 pcode 查询     | 结果表写入 / FTP 上传 / HTTP 下载  | 公众号模板消息推送                   |
| **特殊配置要求**     | 无                                       | 需处理 H5 链接失效（expire_in）          | 需部署前置机、提供数据库权限       | 需配置公众号类目、模板、关联小程序   |
| **错误码差异**       | 基础错误码（如 900034、600001-600003）   | 新增余额不足（600009）、无权限（600081） | 无明确错误码，侧重数据读写异常     | 无错误码，侧重配置步骤正确性         |