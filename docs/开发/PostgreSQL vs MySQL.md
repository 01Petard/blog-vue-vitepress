# PostgreSQL vs MySQL

在选择开源关系型数据库管理系统时，PostgreSQL 和 MySQL 是最常被提及的两个名字。

- **MySQL**：以 “简单易用” 和 “查询速度快” 著称，是很多 Web 开发者的首选。
- **PostgreSQL**：以 “功能强大” 和 “标准支持度高” 闻名，被称为 “开源界的 Oracle”。

下面我们从多个维度对 PostgreSQL 16.x 与 MySQL 8.x 进行对比：

## 1) 核心功能

| 特性               | PostgreSQL                       | MySQL                                      |
| ------------------ | -------------------------------- | ------------------------------------------ |
| ACID 支持          | ✔️                                | ✔️                                          |
| 存储引擎           | 单一引擎（Heap）                 | 多存储引擎（如 InnoDB、MyISAM）            |
| 全文搜索           | ✔️ 内置强大支持                   | ✔️ 有限支持（InnoDB 可用）                  |
| CHECK 约束         | ✔️ 严格支持                       | 8.0.16 后才真正支持                        |
| 外键级联删除       | ✔️ 支持 DROP CASCADE              | ❌ 不支持 DROP CASCADE                      |
| TRUNCATE           | ✔️ 支持事务、安全回滚、CASCADE 等 | ❌ 不可回滚，功能较少                       |
| 自增列             | SERIAL 或 IDENTITY               | AUTO_INCREMENT                             |
| 身份列（IDENTITY） | ✔️                                | ❌                                          |
| 布尔类型           | 有真正的 BOOLEAN 类型            | 用 TINYINT (1) 代替                        |
| IP 类型            | 内建 inet 类型                   | ❌                                          |
| 默认值支持         | 支持函数或常量                   | 仅支持常量或 CURRENT_TIMESTAMP（部分字段） |

## 2) 查询能力

| 特性               | PostgreSQL          | MySQL                |
| ------------------ | ------------------- | -------------------- |
| 窗口函数           | ✔️                   | ✔️                    |
| CTE（WITH 查询）   | ✔️                   | ✔️（MySQL 8.0 起）    |
| 物化视图           | ✔️                   | ❌                    |
| INTERSECT / EXCEPT | ✔️                   | ✔️（MySQL 8.0.31 起） |
| FULL OUTER JOIN    | ✔️                   | ❌                    |
| 部分索引           | ✔️                   | ❌                    |
| 表继承             | ✔️（类面向对象设计） | ❌                    |

## 3) 索引与性能

| 特性              | PostgreSQL             | MySQL                                     |
| ----------------- | ---------------------- | ----------------------------------------- |
| 表达式索引        | ✔️                      | ✔️（8.0.13 起称为函数索引）                |
| 覆盖索引          | ✔️（9.2 起）            | ✔️                                         |
| 位图索引          | ✔️                      | ❌                                         |
| 分区表            | 支持 RANGE / LIST 分区 | 支持 RANGE / LIST / HASH / KEY / 组合分区 |
| 触发器（Trigger） | 支持多类型触发器       | 限制较多                                  |
| 任务调度器        | 使用 pgAgent           | 使用 EVENT SCHEDULER                      |

## 4) 连接与并发

| 特性         | PostgreSQL                              | MySQL                                      |
| ------------ | --------------------------------------- | ------------------------------------------ |
| 连接管理     | 依赖 `pgBouncer` 等连接池工具优化       | 内置连接池，支持 `max_connections` 配置    |
| 并发模型     | 采用 MVCC（多版本并发控制）+ 快照隔离   | 主要依赖 MVCC（InnoDB 引擎），锁机制更复杂 |
| 并行查询支持 | 支持多进程 / 线程并行执行查询（可配置） | 8.0 后逐步增强并行查询，需手动开启优化     |
| 高并发写入   | 写操作通过 WAL（预写日志）保证效率      | InnoDB 依赖 redo/undo 日志，高写入需调参   |

## 5) 扩展与生态

| 特性         | PostgreSQL                                       | MySQL                                      |
| ------------ | ------------------------------------------------ | ------------------------------------------ |
| 插件扩展     | 丰富扩展（PostGIS 地理信息、TimescaleDB 时序等） | 依赖存储引擎 / 第三方插件（如 MyRocks）    |
| 数据分析生态 | 无缝对接 PostGIS、Citus（分布式）                | 需依赖 TiDB 等生态扩展实现分布式           |
| 云原生适配   | 兼容各大云厂商托管服务（AWS RDS、阿里云等）      | 云厂商深度优化（如 AWS Aurora 基于 MySQL） |

## 6) 语法与标准兼容

| 特性         | PostgreSQL                           | MySQL                                            |
| ------------ | ------------------------------------ | ------------------------------------------------ |
| SQL 标准支持 | 严格遵循 SQL 标准（如 `MERGE` 语法） | 部分语法简化（如 `INSERT ... ON DUPLICATE KEY`） |
| 自定义类型   | 支持复合类型、域（Domain）定义       | 依赖枚举 / JSON 模拟复杂类型                     |
| 存储过程语言 | 支持 PL/pgSQL、Python 等多语言       | 主要用 SQL/PL 存储过程，生态较单一               |