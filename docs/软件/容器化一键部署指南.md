# ðŸš€ å®¹å™¨åŒ–ä¸€é”®éƒ¨ç½²æŒ‡å—

ä»¥ä¸‹æ–‡æ¡£å°†é€šè¿‡ Docker å¿«é€Ÿæ­å»º **MySQL**ã€**Redis**ã€**Java åŽç«¯** å’Œ **Nginx**ï¼ˆé™æ€èµ„æº + åå‘ä»£ç†ï¼‰çš„å®Œæ•´çŽ¯å¢ƒã€‚

## ðŸ³ é›¶ã€dockerå‘½ä»¤è¡¥å……

| æ“ä½œ         | å‘½ä»¤                                |
| ------------ | ----------------------------------- |
| å¯åŠ¨æœåŠ¡     | `docker-compose up -d`              |
| åœæ­¢æœåŠ¡     | `docker-compose down`               |
| æŸ¥çœ‹æ—¥å¿—     | `docker-compose logs -f`            |
| é‡å»ºæœåŠ¡     | `docker-compose up --build -d`      |
| åˆ é™¤æ‰€æœ‰å®¹å™¨ | `docker rm -f $(docker ps -aq)`     |
| åˆ é™¤æ‰€æœ‰é•œåƒ | `docker rmi -f $(docker images -q)` |

## ðŸ“‚ ä¸€ã€ç›®å½•ç»“æž„è§„èŒƒåŠè¯´æ˜Ž

æ‰€æœ‰æ–‡ä»¶æ”¾åœ¨åŒä¸€é¡¹ç›®æ ¹ç›®å½•

```
your-project/
â”œâ”€â”€ app.jar                # åŽç«¯æ‰“åŒ…å¥½çš„ Java åº”ç”¨
â”œâ”€â”€ dist/                  # å‰ç«¯æž„å»ºäº§ç‰©
â”‚   â””â”€â”€ index.html
â”œâ”€â”€ nginx/
â”‚   â””â”€â”€ conf.d/
â”‚       â””â”€â”€ default.conf   # Nginx é…ç½®ï¼ˆé™æ€ + /api ä»£ç†ï¼‰
â”œâ”€â”€ docker-compose.yml     # Docker Compose ç¼–æŽ’é…ç½®
â””â”€â”€ setup.sh               # ä¸€é”®åˆå§‹åŒ–è„šæœ¬
```

ç›®å½•ç»“æž„è¯´æ˜Ž

| æ–‡ä»¶/ç›®å½•                   | ä½œç”¨                                                   |
| --------------------------- | ------------------------------------------------------ |
| `app.jar`                   | Java åŽç«¯æ‰“åŒ…åŒ…ï¼ŒæŒ‚è½½åˆ°å®¹å™¨ `/app.jar`                 |
| `dist/`                     | å‰ç«¯é™æ€èµ„æºç›®å½•ï¼Œæ˜ å°„åˆ° Nginx `/usr/share/nginx/html` |
| `nginx/conf.d/default.conf` | Nginx é…ç½®ï¼Œè´Ÿè´£é™æ€æ‰˜ç®¡å’Œ `/api` ä»£ç†                 |
| `docker-compose.yml`        | å®šä¹‰å„æœåŠ¡ï¼šMySQLã€Redisã€Javaã€Nginx                  |
| `setup.sh`                  | è‡ªåŠ¨ç”Ÿæˆç›®å½•ã€é…ç½®å’Œ `docker-compose.yml`              |

## ðŸ“ äºŒã€æ ¸å¿ƒé…ç½®

### 1. `docker-compose.yml`

**å¿…é¡»è¦ä¿®æ”¹**çš„æ˜¯mysqlå’Œredisçš„å¯†ç ï¼Œå…¶ä»–çš„å¯ä»¥ä¸æ”¹

```yaml
version: '1.0'

services:
  mysql:
    image: mysql:8.0.32
    container_name: mysql
    restart: always
    command: --default-authentication-plugin=mysql_native_password
    environment:
      TZ: Asia/Shanghai
      MYSQL_ROOT_PASSWORD: "123456"
    ports:
      - "3306:3306"
    volumes:
      - mysql_data:/var/lib/mysql

  redis:
    image: redis:7.2.0
    container_name: redis
    restart: always
    command: redis-server --requirepass "123456"
    volumes:
      - redis_data:/data

  java-app:
    image: openjdk:8-jdk
    container_name: java-app
    restart: always
    ports:
      - "8080:8080"
    depends_on: [mysql, redis]
    volumes:
      - ./app.jar:/app.jar
    command: |
      java -Xmx3g -Xms3g \
           -XX:+UseG1GC \
           -jar /app.jar

  nginx:
    image: nginx:1.25.3
    container_name: nginx
    restart: always
    depends_on: [java-app]
    ports:
      - "80:80"
    volumes:
      - ./dist:/usr/share/nginx/html
      - ./nginx/conf.d:/etc/nginx/conf.d

volumes:
  mysql_data:
  redis_data:
```

### 2. `nginx/conf.d/default.conf`

**ä»…ä½œä¸¾ä¾‹è¯´æ˜Ž**ï¼Œè¯·ä»¥å¼€å‘çš„é…ç½®ä¸ºå‡†

```nginx
server {
    listen 80;
    server_name localhost;

    # å‰ç«¯é¡µé¢
    location / {
        root /usr/share/nginx/html;
        index index.html;
        try_files $uri $uri/ /index.html;
    }

    # åŽç«¯ API
    location /api/ {
        proxy_pass http://java-app:8080/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
    }
}
```

## âš™ï¸ ä¸‰ã€nginxé…ç½®åˆå§‹åŒ–è„šæœ¬

è¯¥è„šæœ¬å°†è‡ªåŠ¨ï¼š

- åˆ›å»ºå‰ç«¯å’Œ nginx é…ç½®ç›®å½•
- è‡ªåŠ¨ç”Ÿæˆ `nginx/conf.d/default.conf`

```bash
#!/usr/bin/env bash
set -e

PROJECT_ROOT="$(pwd)"
echo "ðŸ“ é¡¹ç›®æ ¹ç›®å½•ï¼š${PROJECT_ROOT}"

# åˆ›å»ºnginxçš„é…ç½®ç›®å½•
mkdir -p nginx/conf.d

# ç”Ÿæˆ nginx é…ç½®
cat > nginx/conf.d/default.conf <<'EOF'


ã€ã€ã€å°†nginxçš„é…ç½®å¤åˆ¶åˆ°è¿™é‡Œã€‘ã€‘ã€‘


EOF

echo "âœ… å·²ç”Ÿæˆ nginx/conf.d/default.conf"

# æç¤ºåŽç»­æ“ä½œ
cat <<EOF

ðŸŽ‰ åˆå§‹åŒ–å®Œæˆï¼Œè¯·æŒ‰ä»¥ä¸‹æ­¥éª¤ç»§ç»­ï¼š

1. å°†åŽç«¯ jar åŒ…æ”¾åˆ°é¡¹ç›®æ ¹ç›®å½•ï¼š
   cp /tmp/app.jar ${PROJECT_ROOT}/app.jar

2. å°†å‰ç«¯æ‰“åŒ…æ–‡ä»¶æ”¾å…¥ dist/ ç›®å½•ï¼š
   cp -r /tmp/dist/* ${PROJECT_ROOT}/dist/

3. å¯åŠ¨æœåŠ¡ï¼š
   docker-compose up -d

4. åœæ­¢å¹¶æ¸…ç†èµ„æºï¼š
   docker-compose down -v

ðŸŒ è®¿é—®ï¼š
- http://localhost/app_endpoint

EOF
```